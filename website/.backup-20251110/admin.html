<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Ace#1</title>
    <link rel="stylesheet" href="/assets/css/marketplace.css">
</head>
<body>
    <div id="admin-login" style="display: none;">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Admin Login</h1>
                <p>Enter your admin credentials</p>
            </div>
            <div id="admin-message"></div>
            <form onsubmit="handleAdminLogin(event)">
                <div class="form-group">
                    <label>Admin Email</label>
                    <input type="email" id="admin-email" required value="admin@ace1health.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="admin-password" required placeholder="Admin@123">
                </div>
                <button type="submit" class="btn-primary">Login as Admin</button>
            </form>
            <div class="form-links">
                <p><a href="/shop.html">Back to Marketplace</a></p>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" style="display: none;">
        <div class="admin-nav">
            <div>
                <h1>üîß Admin Dashboard</h1>
                <p id="admin-welcome" style="margin: 5px 0 0; opacity: 0.9;"></p>
            </div>
            <button class="logout-btn" onclick="adminLogout()">Logout</button>
        </div>

        <div class="admin-container">
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showTab('overview')">Overview</button>
                <button class="admin-tab" onclick="showTab('orders')">Orders</button>
                <button class="admin-tab" onclick="showTab('products')">Products</button>
                <button class="admin-tab" onclick="showTab('customers')">Customers</button>
            </div>

            <div id="tab-overview" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Orders</h3>
                        <div class="stat-value" id="stat-orders">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Revenue</h3>
                        <div class="stat-value" id="stat-revenue">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Customers</h3>
                        <div class="stat-value" id="stat-customers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="stat-value" id="stat-products">0</div>
                    </div>
                </div>
            </div>

            <div id="tab-orders" class="tab-content" style="display: none;">
                <div class="profile-section">
                    <h2>All Orders</h2>
                    <div id="orders-list">Loading...</div>
                </div>
            </div>

            <div id="tab-products" class="tab-content" style="display: none;">
                <div class="profile-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">Products</h2>
                        <button class="btn-primary" style="width: auto;" onclick="alert('Product management coming soon! Edit /assets/data/products.json directly.')">Add Product</button>
                    </div>
                    <div id="products-list">Loading...</div>
                </div>
            </div>

            <div id="tab-customers" class="tab-content" style="display: none;">
                <div class="profile-section">
                    <h2>Customers</h2>
                    <div id="customers-list">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/js/config.js"></script>
    <script src="/assets/js/cart.js"></script>
    <script src="/assets/js/auth.js"></script>
    <script>
        // Check if user is logged in and is admin
        function checkAdminAccess() {
            const user = window.auth.getCurrentUser();
            if (user && user.role === 'admin') {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                document.getElementById('admin-welcome').textContent = `Welcome, ${user.firstName}!`;
                loadAdminData();
            } else {
                document.getElementById('admin-login').style.display = 'block';
                document.getElementById('admin-dashboard').style.display = 'none';
            }
        }

        function handleAdminLogin(event) {
            event.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const messageDiv = document.getElementById('admin-message');

            const result = window.auth.login(email, password);

            if (result.success) {
                const user = window.auth.getCurrentUser();
                if (user.role === 'admin') {
                    messageDiv.innerHTML = '<div class="success-message">Admin login successful!</div>';
                    setTimeout(() => checkAdminAccess(), 500);
                } else {
                    messageDiv.innerHTML = '<div class="error-message">You do not have admin access.</div>';
                    window.auth.logout();
                }
            } else {
                messageDiv.innerHTML = '<div class="error-message">' + result.message + '</div>';
            }
        }

        function adminLogout() {
            if (confirm('Logout from admin panel?')) {
                window.auth.logout();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            document.getElementById('tab-' + tabName).style.display = 'block';
        }

        function loadAdminData() {
            // Load all users
            const users = JSON.parse(localStorage.getItem('ace1_users') || '[]');
            
            // Collect all orders from all users
            let allOrders = [];
            users.forEach(user => {
                if (user.orders && user.orders.length > 0) {
                    user.orders.forEach(order => {
                        allOrders.push({
                            ...order,
                            customerName: `${user.firstName} ${user.lastName}`,
                            customerEmail: user.email
                        });
                    });
                }
            });

            // Load products
            fetch('/assets/data/products.json')
                .then(r => r.json())
                .then(products => {
                    // Update stats
                    document.getElementById('stat-orders').textContent = allOrders.length;
                    const totalRevenue = allOrders.reduce((sum, order) => sum + order.total, 0);
                    document.getElementById('stat-revenue').textContent = '$' + totalRevenue.toFixed(2);
                    document.getElementById('stat-customers').textContent = users.filter(u => u.role !== 'admin').length;
                    document.getElementById('stat-products').textContent = products.length;

                    // Display orders
                    if (allOrders.length === 0) {
                        document.getElementById('orders-list').innerHTML = '<p style="text-align: center; padding: 40px;">No orders yet.</p>';
                    } else {
                        document.getElementById('orders-list').innerHTML = `
                            <table class="orders-table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${allOrders.reverse().map(order => `
                                        <tr>
                                            <td><strong>${order.id}</strong></td>
                                            <td>${order.customerName}<br><small style="color: #666;">${order.customerEmail}</small></td>
                                            <td>${new Date(order.date).toLocaleDateString()}</td>
                                            <td>${order.items.length} item(s)</td>
                                            <td><strong>$${order.total.toFixed(2)}</strong></td>
                                            <td><span class="order-status ${order.status.toLowerCase()}">${order.status}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                    }

                    // Display products
                    document.getElementById('products-list').innerHTML = `
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${products.map(product => `
                                    <tr>
                                        <td><code>${product.id}</code></td>
                                        <td><strong>${product.name}</strong></td>
                                        <td>${product.category}</td>
                                        <td>$${product.price.toFixed(2)}</td>
                                        <td><span style="color: ${product.inStock ? '#4caf50' : '#ff4444'};">${product.inStock ? 'In Stock' : 'Out of Stock'}</span></td>
                                        <td>${product.rating} ‚≠ê (${product.reviews})</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;

                    // Display customers
                    const customers = users.filter(u => u.role !== 'admin');
                    if (customers.length === 0) {
                        document.getElementById('customers-list').innerHTML = '<p style="text-align: center; padding: 40px;">No customers yet.</p>';
                    } else {
                        document.getElementById('customers-list').innerHTML = `
                            <table class="orders-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Orders</th>
                                        <th>Joined</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${customers.map(customer => `
                                        <tr>
                                            <td><strong>${customer.firstName} ${customer.lastName}</strong></td>
                                            <td>${customer.email}</td>
                                            <td>${customer.phone || 'N/A'}</td>
                                            <td>${customer.orders ? customer.orders.length : 0}</td>
                                            <td>${new Date(customer.createdAt).toLocaleDateString()}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                    }
                });
        }

        // Initialize
        checkAdminAccess();
    </script>
</body>
</html>
